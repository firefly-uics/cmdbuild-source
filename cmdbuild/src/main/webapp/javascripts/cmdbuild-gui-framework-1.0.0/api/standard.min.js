!function(e){var t={tab:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t);e("#"+i.form).tabs("option","active",t.activeTab)},navigate:function(t){try{var i=e.Cmdbuild.elementsManager.getElement(t.form),a=e.Cmdbuild.utilities.getFields(i);a&&a.fields&&(a.form=t.form,e.Cmdbuild.dataModel.putFormFields(a)),e.Cmdbuild.utilities.include(i,this.navigateIncludeCB,{xmlForm:i,param:t},void 0)}catch(n){console.log("Commands navigate "+n.message,t,n.stack)}},navigateIncludeCB:function(t){var i=t.xmlForm,a=t.param;e.Cmdbuild.elementsManager.getParams(i,a);var n=e.Cmdbuild.elementsManager.isObserving(i,a.form),r=e.Cmdbuild.standard[a.type]||e.Cmdbuild.custom[a.type];if(!a.type||!r)throw new e.Cmdbuild.errorsManager.getError({message:e.Cmdbuild.errorsManager.CMERROR,type:e.Cmdbuild.errorsManager.PARAMNOTCORRECT,param:"type",method:"navigate",element:a.form});if(!n||"true"===a.fromObserving){var d=e.Cmdbuild.dataModel.resolveVariables(a);try{var l=r,s=void 0;e.Cmdbuild.dataModel.forms[a.form]?s=e.Cmdbuild.dataModel.forms[a.form]:(s=new l,e.Cmdbuild.dataModel.forms[a.form]=s),e.Cmdbuild.standard.contextStack.pop(d),e.Cmdbuild.standard.contextStack.push(d),s.init(d)}catch(o){console.log(o,o.stack)}}},advance:function(t){try{if(t.formObject=e.Cmdbuild.dataModel.forms[t.form],!e.Cmdbuild.dataModel.change(t))return;e.Cmdbuild.dataModel.flush(t,function(i){if(t.dialog)return void e.Cmdbuild.standard.commands.dialogClose(t);var a=e.Cmdbuild.dataModel.model[t.form].data;return a._id||(a._id=i,a._type=t.formObject.param.className),t.navigationForm?void e.Cmdbuild.standard.commands.navigate({form:t.navigationForm,container:t.navigationContainer}):void e.Cmdbuild.utilities.proxy.getActivity(a._type,a._id,function(i){if(0!=i.length)e.Cmdbuild.standard.commands.navigate({form:t.form,container:t.container,className:a._type,cardId:a._id,activityInstanceId:i[0]._id});else if(t.tab){var n=e.Cmdbuild.dataModel.resolveVariables(t);e("#"+n.tabbedForm).tabs("option","active",t.tab)}},this)})}catch(i){e.Cmdbuild.errorsManager.popup(i)}},save:function(t){try{if(t.ldap&&e.Cmdbuild.ldap.write({form:t.form,ldapDescriptor:t.ldap}),t.formObject=e.Cmdbuild.dataModel.forms[t.form],!e.Cmdbuild.dataModel.change(t))return;if(e.Cmdbuild.dataModel.flush(t,function(i){return t.dialog?void e.Cmdbuild.standard.commands.dialogClose(t):void 0}),t.navigationForm)return void e.Cmdbuild.standard.commands.navigate({form:t.navigationForm,container:t.navigationContainer})}catch(i){e.Cmdbuild.errorsManager.popup(i)}},cancel:function(t){try{var i=e.Cmdbuild.elementsManager.getElement(t.form);if(e.Cmdbuild.elementsManager.getParams(i,t),t.backend=e.Cmdbuild.utilities.getBackend(t.backend),t.formObject=e.Cmdbuild.dataModel.forms[t.form],e.Cmdbuild.dataModel.reset(t),t.navigationForm)return void e.Cmdbuild.standard.commands.navigate({form:t.navigationForm,container:t.navigationContainer})}catch(a){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.commands.cancel"),a}},dialogExec:function(t){e.Cmdbuild.standard.referenceField.onChangeLookup(t),e("#"+t.dialog).dialog("close")},dialogClose:function(t){if(t.dialog){var i=e.Cmdbuild.dataModel.resolveVariables(t);e("#"+i.dialog).dialog("close")}},dialogCancel:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t);i.form&&i.selection&&e.Cmdbuild.standard.grid.cancelSelection(i.form),e("#"+i.dialog).dialog("close")},fieldChanged:function(t){var i=e("#"+t.id).attr("fieldName");t.fieldName=i||t.id,t.formName=e("#"+t.id).attr("formName"),e.Cmdbuild.CqlManager.fieldChanged(t.formName,t.fieldName)},deleteRow:function(t){var i=e.Cmdbuild.dataModel.forms[t.form],a=i.getBackend();a.deleteRow({form:t.form},function(){t.navigationForm?e.Cmdbuild.standard.commands.navigate({form:t.navigationForm,container:t.navigationContainer}):e.Cmdbuild.standard.grid.onNavigate("begin",t.form)})},attach:function(t){var i=e.Cmdbuild.dataModel.forms[t.form],a=i.getBackend(),n=[],r=e("#"+t.description).val(),d=e("#"+t.category).val(),l=document.getElementById(t.id).files[0];if(l||n.push({field:e("#"+t.id).attr("fieldName"),errorType:e.Cmdbuild.global.NOVALUEONREQUIREDFIELD}),""==e.trim(r)&&n.push({field:e("#"+t.description).attr("fieldName"),errorType:e.Cmdbuild.global.NOVALUEONREQUIREDFIELD}),""==e.trim(d)&&n.push({field:e("#"+t.category).attr("fieldName"),errorType:e.Cmdbuild.global.NOVALUEONREQUIREDFIELD}),n.length>0)return void e.Cmdbuild.errorsManager.popupOnRequestFields(n);var s=new FileReader;s.readAsText(l),s.onload=function(i){var n=new FormData;n.append("file",l),n.append("attachment",new Blob([JSON.stringify({_description:r,_category:d})],{type:"application/json"})),a.addRow({form:param.form,row:{description:r,category:d,formdata:n}}),e("#"+t.description).val(""),e("#"+t.category).val(""),e("#"+t.id).val(""),e.Cmdbuild.standard.grid.onNavigate("begin",param.form)}},fieldRefresh:function(t){var i=e.Cmdbuild.dataModel.forms[t.form];i.refreshField(t)},reportParamsSend:function(t){try{if(t.type="form",!e.Cmdbuild.dataModel.change(t))return;var i=e.Cmdbuild.dataModel.getValues(t.form),a={};for(var n in i){var r=n.replace(/_PT_/g,".");r=r.replace(/_SP_/g," "),a[r]=i[n]}var d=e.Cmdbuild.utilities.getBackend(t.backend);d.showReport(a)}catch(l){e("#"+t.dialog).dialog("close"),e.Cmdbuild.errorsManager.log(l),e.Cmdbuild.errorsManager.popup(l)}e("#"+t.dialog).dialog("close")},requestReportParameters:function(t){var i=e.Cmdbuild.utilities.getBackend(t.backend);e.Cmdbuild.utilities.setAttributesInteractivity(t.attributes);for(var a=0;a<t.attributes.length;a++)t.attributes[a].name=t.attributes[a].name.replace(/[.]/g,"_PT_"),t.attributes[a].name=t.attributes[a].name.replace(/[ ]/g,"_SP_");i.data.attributes=t.attributes,e.Cmdbuild.standard.commands.navigate(t)},printReport:function(t){var i=e.Cmdbuild.elementsManager.getElement(t.form),a={};e.Cmdbuild.elementsManager.getParams(i,a);var n=e.Cmdbuild.utilities.getBackend(a.backend),r=e.Cmdbuild.dataModel.getValue(t.form,"id"),d=e.Cmdbuild.dataModel.getValue(t.form,"type");t.typeReport=d,t.id=r,t.form=t.formDialog,n.requestReport(t)},saveattachments:function(e){this.dialogClose(e)},deleteMail:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t),a=e.Cmdbuild.dataModel.forms[i.formData],n=a.getBackend();n.deleteMail(i),this.refreshGrid(i,function(){})},replyMail:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t);e.Cmdbuild.standard.commands.navigate({form:i.navigationForm,dialog:i.navigationDialog})},refreshMail:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t),a=e.Cmdbuild.dataModel.forms[i.formData],n=e.Cmdbuild.dataModel.getValues(i.form),r=a.getBackend().widgets;e.Cmdbuild.dataModel.detachObserving(),e.Cmdbuild.widgets.refreshTemplate(i.formData,r,n.fromTemplate),e.Cmdbuild.dataModel.attachObserving();var d=this;this.TM=setTimeout(function(){d.refreshGrid(i,function(){})},500)},refreshGrid:function(t,i,a){var n=e("#"+t.form).DataTable();n.ajax.reload(function(e){i&&i.apply(a)})},synchronizeMails:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t),a=e.Cmdbuild.dataModel.getWidgetWindow(i.widgetName),n=e.Cmdbuild.standard.grid.getChecked(i.form),r=a.data.type,d=a.data.templates,l=e.Cmdbuild.standard.widgetDiv.widgetName(r);e.Cmdbuild.widgets[l]&&e.Cmdbuild.widgets[l].setSynchronization&&e.Cmdbuild.widgets[l].setSynchronization(d,n,!0,!1);for(var s=0;s<d.length;s++){var o=d[s];"true"==n[o._id]&&e.Cmdbuild.widgets.ManageEmail.cqlResolve(i.formData,o,function(){},this)}e("#"+i.dialog).dialog("close")},noSynchronizeMails:function(t){var i=e.Cmdbuild.dataModel.resolveVariables(t),a=e.Cmdbuild.dataModel.getWidgetWindow(i.widgetName),n=a.data.templates,r=a.data.type,d=e.Cmdbuild.standard.widgetDiv.widgetName(r);e.Cmdbuild.widgets[d]&&e.Cmdbuild.widgets[d].setSynchronization&&e.Cmdbuild.widgets[d].setSynchronization(n,{},!1,!1),e("#"+i.dialog).dialog("close")},downloadAttachment:function(t){var i=e.Cmdbuild.dataModel.resolveVariable(t.className),a=e.Cmdbuild.dataModel.resolveVariable(t.cardId),n=e.Cmdbuild.dataModel.resolveVariable(t.attachmentName),r=e.Cmdbuild.dataModel.resolveVariable(t.attachmentId),d=e.Cmdbuild.global.getApiUrl()+"processes/"+i+"/instances/"+a+"/attachments/"+r+"/"+n+"?CMDBuild-Authorization="+e.Cmdbuild.authentication.getAuthenticationToken();window.location.replace(d)}};e.Cmdbuild.standard.commands=t}(jQuery),function(e){var t={NUMROWGRIDREFERENCE:10};e.Cmdbuild.standard.configuration=t}(jQuery),function(e){var t=function(){this.param=void 0,this.init=function(t){try{this.param=t,this.show()}catch(i){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.init"),i}},this.show=function(){try{var t=e.Cmdbuild.elementsManager.getElement(this.param.form);e.Cmdbuild.eventsManager.deferEvents();var i="";i+=e.Cmdbuild.elementsManager.insertChildren(t);var a=e.Cmdbuild.utilities.getWidgetsFromXML(t),n=[];a&&a.length&&e.each(a,function(e,t){n.push(t)}),n&&n.length&&(e.Cmdbuild.widgets.prepareFields(n),i+=e.Cmdbuild.standard.widgetDiv.getWidgetDiv({container:this.param.container,form:this.param.form,readOnly:this.param.readonly,widgets:n}));var r=e("#"+this.param.container)[0];r.innerHTML=i,e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents()}catch(d){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.show"),d}}};e.Cmdbuild.standard.div=t}(jQuery),function(e){var t={canvas3d:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);i+="<div  "+a+"></div>";var n=e.Cmdbuild.elementsManager.getXmlElementId(t);return e.Cmdbuild.scriptsManager.push({script:"canvas3d",id:n}),i},dialog:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);i+="<div"+a+"></div>";var n=e.Cmdbuild.elementsManager.getXmlElementId(t);return e.Cmdbuild.scriptsManager.push({script:"dialog",id:n}),i},spinner:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.elementsManager.insertLabel(t),r=e.Cmdbuild.elementsManager.getEvent("onChange",t),d=e.Cmdbuild.elementsManager.getParams(t),l=d.value,s="<input  "+a+" name='value' valueType='spinner' value='"+l+"'></input>",o=e.Cmdbuild.elementsManager.getXmlElementId(t);e.Cmdbuild.scriptsManager.push({script:"spinner",id:o,spin:r,value:l});var i=e.Cmdbuild.elementsManager.wrapInFormRow(n,s,"input");return i},checkbox:function(t){var i=e.Cmdbuild.elementsManager.getXmlElementId(t),a=t.getAttribute("text");a=a?a:"false";var n=e.Cmdbuild.elementsManager.getCommonAttributes(t),r=e.Cmdbuild.utilities.getEventLikeString(t,"onClick");e.Cmdbuild.scriptsManager.push({script:"checkbox",id:i});var d="";"true"==a&&(d=" checked ");var l=e.Cmdbuild.elementsManager.insertLabel(t),s="<input type='checkbox'"+d+n+r+"value='"+a+"' />",o=e.Cmdbuild.elementsManager.wrapInFormRow(l,s,"checkbox");return o},button:function(t){var i=e.Cmdbuild.elementsManager.getParams(t),a=e.Cmdbuild.dataModel.resolveVariables(i);if(void 0!==a.condition&&!a.condition)return"";var n="";n+=e.Cmdbuild.elementsManager.insertLabel(t);var r=e.Cmdbuild.elementsManager.getText(t),d=e.Cmdbuild.elementsManager.getCommonAttributes(t),l=e.Cmdbuild.utilities.getEventLikeString(t,"onClick"),s="true"==a.readOnly?" disabled ":"";n+="<input type='button'"+d+l+s+" value='"+r+"' />",n+=e.Cmdbuild.elementsManager.insertReturn(t);var o=e.Cmdbuild.elementsManager.getXmlElementId(t);return i&&e.Cmdbuild.dataModel.prepareCallerParameters(o,i),e.Cmdbuild.scriptsManager.push({script:"button",id:o}),n},upload:function(t){var i=e.Cmdbuild.elementsManager.insertLabel(t),a=e.Cmdbuild.elementsManager.getText(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t),r=e.Cmdbuild.utilities.getEventLikeString(t,"onChange"),d=a+": <input type='file' name='filename'"+n+r+" />";d+=e.Cmdbuild.elementsManager.insertReturn(t);var l=e.Cmdbuild.elementsManager.wrapInFormRow(i,d,"upload");return l},iframe:function(t){var i=e.Cmdbuild.utilities.escapeHtml(t.getAttribute("src")),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n="<iframe src='"+i+"'"+a+"/>";return n+=e.Cmdbuild.elementsManager.insertReturn(t)},title:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.utilities.getEventLikeString(t,"onClick"),r="<h2 "+n+a+" >"+i+"</h2>";return r+=e.Cmdbuild.elementsManager.insertReturn(t)},p:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.utilities.getEventLikeString(t,"onClick"),r="<span "+n+a+" >"+i+"</span>";return r+=e.Cmdbuild.elementsManager.insertReturn(t)},span:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.utilities.getEventLikeString(t,"onClick"),r="<span "+n+a+" >"+i+"</span>";return r+=e.Cmdbuild.elementsManager.insertReturn(t)},h1:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n="<h1 "+a+">"+i+"</h1>";return n},h2:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n="<h2 "+a+">"+i+"</h2>";return n},h3:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n="<h3 "+a+">"+i+"</h3>";return n},br:function(e){var t="<br />";return t},img:function(t){var i="",a=t.getAttribute("src");if(!a){var n=e.Cmdbuild.elementsManager.getParams(t),r=e.Cmdbuild.dataModel.resolveVariables(n);a=r.src}var d=e.Cmdbuild.elementsManager.getCommonAttributes(t);return i+="<img"+d+"src='"+a+"' />",i+=e.Cmdbuild.elementsManager.insertReturn(t)},input:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.elementsManager.insertLabel(t),r="",d=t.getAttribute("interactivity"),l=d&&d==e.Cmdbuild.global.READ_ONLY,s=t.getAttribute("maxlength");null!==s&&(a+=" maxlength='"+s+"' "),l?(r=i,r+="<input type='hidden'"+a+"value='"+(i?i:"")+"' />"):r="<input type='text'"+a+"value='"+i+"' />";var o=e.Cmdbuild.elementsManager.wrapInFormRow(n,r,"input",l);return o},integer:function(t){var i=e.Cmdbuild.elementsManager.getText(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.elementsManager.insertLabel(t),r="",d=t.getAttribute("interactivity"),l=d&&d==e.Cmdbuild.global.READ_ONLY;l?(r+=i,r+="<input type='hidden'"+a+"value='"+(i?i:"")+"' />"):r+="<input type='text'"+a+"value='"+i+"' />";var s=e.Cmdbuild.elementsManager.wrapInFormRow(n,r,"integer",l),o=e.Cmdbuild.elementsManager.getXmlElementId(t);return e.Cmdbuild.scriptsManager.push({script:"integer",id:o}),s},date:function(t){var i=e.Cmdbuild.elementsManager.getCommonAttributes(t),a=e.Cmdbuild.elementsManager.getXmlElementId(t),n=e.Cmdbuild.elementsManager.getParams(t),r=t.getAttribute("text");r=r||"",r=e.Cmdbuild.utilities.convertDateDB2GUI(r,n.type),e.Cmdbuild.scriptsManager.push({script:"date",id:a,type:n.type});var d,l=e.Cmdbuild.elementsManager.insertLabel(t),s=t.getAttribute("interactivity"),o=s&&s==e.Cmdbuild.global.READ_ONLY;o?(d=r,d+="<input isDate='"+n.type+"' type='hidden'"+i+"value='"+(r?r:"")+"' />"):d="<input isDate='"+n.type+"' type='text'"+i+"value='"+r+"' />";var m=e.Cmdbuild.elementsManager.wrapInFormRow(l,d,"date",o);return m},textarea:function(t){var i=e.Cmdbuild.elementsManager.getXmlElementId(t),a=e.Cmdbuild.elementsManager.getParams(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t),r=e.Cmdbuild.elementsManager.insertLabel(t),d="",l=a&&a.isHtml?!0:!1,s=t.getAttribute("rows"),o=t.getAttribute("cols"),m="";m=!l&&a&&a.rawText?a.rawText.trim():e.Cmdbuild.elementsManager.getText(t);var u=t.getAttribute("interactivity"),c=u&&u==e.Cmdbuild.global.READ_ONLY,g=t.getAttribute("maxlength");if(null!==g&&(n+=" maxlength='"+g+"' "),c){if(l){var b=document.createElement("div");b.innerHTML=m,b.childNodes.length&&(d='<div class="textareaReadOnly">'+b.childNodes[0].nodeValue+"</div>")}else d=m.replace(/(?:\r\n|\r|\n)/g,"<br />");d+="<textarea class='hiddentextarea'>"+(m?m:"")+"</textarea>"}else d="<textarea  cols='"+o+"' rows='"+s+"' type='text'"+n+"value='"+m+"'>"+m+"</textarea>";var h=e.Cmdbuild.elementsManager.wrapInFormRow(r,d,"textarea",c);return l&&(a={script:"htmlText",id:i},e.Cmdbuild.scriptsManager.push(a)),h},lookup:function(t){var i,a=e.Cmdbuild.elementsManager.getXmlElementId(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t),r=e.Cmdbuild.elementsManager.getParams(t),d=e.Cmdbuild.utilities.getEventLikeString(t,"onChange"),l=e.Cmdbuild.elementsManager.insertLabel(t),s=t.getAttribute("interactivity"),o=s&&s==e.Cmdbuild.global.READ_ONLY;o?i="<input type='hidden'"+n+"value='"+(""|r.value)+"' />":(i="",i+="<select "+n+d+">",i+="</select>",i+="");var m=e.Cmdbuild.elementsManager.wrapInFormRow(l,i,"lookup",o);return r={script:"lookup",id:a,backend:r.backend,lookupName:r.lookupName,value:r.value,readOnly:o},e.Cmdbuild.scriptsManager.push(r),m},select:function(t){var i=e.Cmdbuild.elementsManager.getXmlElementId(t),a=e.Cmdbuild.elementsManager.getCommonAttributes(t),n=e.Cmdbuild.elementsManager.getParams(t),r=e.Cmdbuild.utilities.getEventLikeString(t,"onChange");n=e.extend({script:"select",id:i},n),e.Cmdbuild.scriptsManager.push(n);var d=e.Cmdbuild.elementsManager.insertLabel(t),l="<select "+a+r+">";l+="</select>";var s=t.getAttribute("interactivity"),o=s&&s==e.Cmdbuild.global.READ_ONLY,m=e.Cmdbuild.elementsManager.wrapInFormRow(d,l,"select",o);return m},reference:function(t){var i,a,n=e.Cmdbuild.elementsManager.getXmlElementId(t),r=e.Cmdbuild.elementsManager.getCommonAttributes(t),d=e.Cmdbuild.elementsManager.getParams(t),l=d.backend,s=e.Cmdbuild.elementsManager.insertLabel(t),o=t.getAttribute("interactivity"),m=o&&o==e.Cmdbuild.global.READ_ONLY;if(m)i="<input type='hidden'"+r+"value='"+(""|d.value)+"' />";else{a='$.Cmdbuild.standard.referenceField.onSearchLookup("'+n+'", "'+d.container+'")';var u='$.Cmdbuild.standard.referenceField.onClearLookup("'+n+'")';d.toExecCommand=n,i="<select "+r+" backend='"+l+"' className='"+d.className+"' eventSearch = '"+a+"'>",i+="<option selected></option>",i+="</select>";var c=t.getAttribute("formName"),g=t.getAttribute("fieldName");d.fieldName=g,d.formName=c,i+=this.lookupButtons(n,d.container,a,u),this.lookupDialog(n,d)}var b=e.Cmdbuild.elementsManager.wrapInFormRow(s,i,"reference",m);return d={script:"reference",id:n,eventSearch:a,backend:d.backend,className:d.className,value:d.value,readOnly:m,formNRows:d.formNRows},e.Cmdbuild.scriptsManager.push(d),b},openEntry:function(t,i){var a="",n="",r=e.Cmdbuild.elementsManager.getText(t),d=e.Cmdbuild.elementsManager.getCommonAttributes(t),l=e.Cmdbuild.elementsManager.getXmlElementId(t),s=e.Cmdbuild.elementsManager.getParams(t),o=e.Cmdbuild.dataModel.resolveVariables(s);if(o&&e.Cmdbuild.dataModel.prepareCallerParameters(l,o),0==o.show||1==o.hide)return"";var m=e.Cmdbuild.utilities.getEventLikeString(t,"onClick",'$.Cmdbuild.utilities.currentMenu("'+l+'", "'+i+'");return false;');if(a+="<li "+d+"><span class='ui-icon ui-icon-carat-1-e'></span><a id='"+l+"_aElement' title='"+n+"' href='#'"+m+">"+r+"</a>",t.childNodes.length>0){a+="<ul class='ui-menu'>";for(var u=0;u<t.childNodes.length;u++)"openEntry"==t.childNodes[u].nodeName&&(a+=this.openEntry(t.childNodes[u],i));a+="</ul>"}return a+="</li>",e.Cmdbuild.scriptsManager.push({script:"openMenu",id:l+"_aElement"}),a},openMenu:function(t){var i="",a=e.Cmdbuild.elementsManager.getXmlElementId(t);i+="<ul id='"+a+"' class='ui-menu'>";for(var n=0;n<t.childNodes.length;n++)"openEntry"==t.childNodes[n].nodeName&&(i+=this.openEntry(t.childNodes[n],a));return i+="</ul>"},text:function(t){var i="";i+=e.Cmdbuild.elementsManager.insertLabel(t);var a=e.Cmdbuild.elementsManager.getText(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t);return i+="<span"+n+">"+a+"</span>",i+=e.Cmdbuild.elementsManager.insertReturn(t)},entry:function(t){var i="",a=e.Cmdbuild.elementsManager.getText(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t),r=e.Cmdbuild.utilities.getEventLikeString(t,"onClick");i+="<li"+n+"><a href='#'"+r+">"+a+"</a>";var d=e.Cmdbuild.elementsManager.insertChildren(t);return""!=d&&(i+="<ul>"+d+"</ul>"),i+="</li>"},menu:function(t){var i="",a=e.Cmdbuild.elementsManager.getText(t),n=e.Cmdbuild.elementsManager.getCommonAttributes(t);i+="<ul"+n+">";var r=e.Cmdbuild.elementsManager.getXmlElementId(t);return null!=a&&(i+="<a href='#'>"+a+"</a>"),i+=e.Cmdbuild.elementsManager.insertChildren(t),i+="</ul>",i+=e.Cmdbuild.elementsManager.insertReturn(t),e.Cmdbuild.scriptsManager.push({script:"menu",id:r}),i},divform:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);return i+="<div"+a+"/>"},div:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);i+="<div"+a+">",i+=e.Cmdbuild.elementsManager.insertChildren(t),i+="</div>";var n=e.Cmdbuild.elementsManager.getXmlElementId(t),r=e.Cmdbuild.elementsManager.getEvent("onInit",t),d=e.Cmdbuild.elementsManager.getParams(t);return e.Cmdbuild.dataModel.prepareCallerParameters(n,d),r&&(r.script="init",r.id=n,e.Cmdbuild.scriptsManager.push(r)),i},dl:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);return i+="<dl"+a+">",i+=e.Cmdbuild.elementsManager.insertChildren(t),i+="</dl>"},dd:function(t){var i="",a=e.Cmdbuild.elementsManager.getCommonAttributes(t);return i+="<dd"+a+">",i+=e.Cmdbuild.elementsManager.insertChildren(t),i+="</dd>"},override:function(t){var i=t.getAttribute("container"),a=e("#"+i)[0],n=e.Cmdbuild.elementsManager.insertChildren(t);return a.innerHTML=n,""},gridNavigationBar:function(t){var i="",a={};e.Cmdbuild.elementsManager.getParams(t,a);var n=a.form;return i+="<input type='text' id='"+n+"_filtertext' />",i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_filter","ui-icon-search",'$.Cmdbuild.standard.gridMenu.onFilter("'+n+'", "")'),i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_clearFilter","ui-icon-closethick",'$.Cmdbuild.standard.gridMenu.onClearFilter("'+n+'")'),i+="<span id='"+n+"_pageCount' class='cmdbuildGridNavigationCount'></span>",i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_init","ui-icon-arrowthickstop-1-w",'$.Cmdbuild.standard.gridMenu.onNavigate("begin", "'+n+'")'),i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_previous","ui-icon-arrowthick-1-w",'$.Cmdbuild.standard.gridMenu.onNavigate("previous", "'+n+'")'),i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_next","ui-icon-arrowthick-1-e",'$.Cmdbuild.standard.gridMenu.onNavigate("next", "'+n+'")'),i+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",n+"_end","ui-icon-arrowthickstop-1-e",'$.Cmdbuild.standard.gridMenu.onNavigate("end", "'+n+'")')},grid:function(t){var i=e.Cmdbuild.elementsManager.getXmlElementId(t),a="<table id='"+i+"' class='display' style='width: 100%;'></table>",n={script:"grid",id:i};return e.Cmdbuild.elementsManager.getParams(t,n),n.onClick=e.Cmdbuild.elementsManager.getEvent("onClick",t),e.Cmdbuild.scriptsManager.push(n),a},lookupButtons:function(t,i,a,n){var r="";return r+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",t+"_search","ui-icon-search",a),r+=e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",t+"_clearFilter","ui-icon-closethick",n)},lookupDialog:function(t,i){var a="<form id='"+t+"_dialog' >";a+="<params>",a+="<type>popup</type>",a+="</params>",a+="<div id='"+t+"_dialogDiv' class='cmdbuildDialogContentWrapper'>",a+="<onInit>",a+="<command>navigate</command>",a+="<container>"+t+"_dialogDiv</container>",a+="<form>"+t+"_dialogGrid</form>",a+="<formName>"+i.formName+"</formName>",a+="<fieldName>"+i.fieldName+"</fieldName>",a+="</onInit>",a+="<form id='"+t+"_dialogGrid'>",a+="<params>",a+="<type>grid</type>",a+="<className>"+i.className+"</className>",a+="<backend>"+i.backend+"</backend>",a+="<nRows>"+e.Cmdbuild.global.configurationValue("NUMROWGRIDREFERENCE")+"</nRows>",a+="<lookup>true</lookup>",a+="<navigation>false</navigation>",a+="<sort>Description</sort>",a+="<direction>asc</direction>",a+="</params>",a+="<onDblClick>",a+="<command>dialogExec</command>",a+="<toExecCommand>"+i.toExecCommand+"</toExecCommand>",a+="<bReference>"+i.bReference+"</bReference>",a+="<dialog>"+t+"_lookupDialog</dialog>",a+="</onDblClick>",a+="</form>",a+="</div>",a+="<div class='cmdbuildFooterButtonsWrapper'>",a+="<button text='Ok' id='"+t+"_dialogOk'>",a+="<onClick>",a+="<command>dialogExec</command>",a+="<toExecCommand>"+i.toExecCommand+"</toExecCommand>",a+="<bReference>"+i.bReference+"</bReference>",a+="<dialog>"+t+"_lookupDialog</dialog>",a+="</onClick>",a+="</button>",a+="<button text='Cancel' id='"+t+"_dialogCancel'>",a+="<onClick>",a+="<command>dialogClose</command>",a+="<dialog>"+t+"_lookupDialog</dialog>",a+="</onClick>",a+="</button>",a+="</div>",a+="</form>";var n=new DOMParser;xDoc=n.parseFromString(a,"text/xml");var r=xDoc.documentElement,d=e.Cmdbuild.elementsManager.getElement(i.container);d.appendChild(r)}};e.Cmdbuild.standard.elements=t}(jQuery),function(e){var t="_NOGROUP_",i="Others",a=function(){this.param=void 0,this.backend=void 0,this.lookUps=[],this.init=function(t){this.id=t.form;var i=e.Cmdbuild.elementsManager.getElement(this.id),a=e.Cmdbuild.utilities.getFields(i);a&&a.fields&&(a.form=this.id,e.Cmdbuild.dataModel.putFormFields(a));try{this.param=t;var n=e.Cmdbuild.utilities.getBackend(t.backend),r=new n(t,this.show,this);this.setBackend(r)}catch(d){console.log("WARNING: No data message "+d.message);var l=e("#"+this.param.container)[0];l.innerHTML="<h1>NO DATA</h1>"}},this.flush=function(e,t,i){this.getBackend().updateData(e,t,i)},this.refreshField=function(t){t.id=t.form+"_"+t.field;var i=e("#"+t.id);i[0]?e.Cmdbuild.standard.referenceField.chargeLookup(t):e.Cmdbuild.widgets.refreshCqlField(t.form,this.getBackend().widgets)},this.reset=function(t){for(var i in t.data){var a=e("#"+t.form+"_"+i);a&&a.val(t.data[i])}},this.getValue=function(t){var i=e.Cmdbuild.utilities.getHtmlFieldValue("#"+t.form+"_"+t.field);return null===i&&(i=e.Cmdbuild.dataModel.getValue(t.form,t.field)),i},this.getClientDescription=function(e,t,i){var a=this.getBackend().getAttributes(),n=this.getValue(e);this.getDescription(e,a,n,function(e){t.apply(i,[e])},this)},this.getServerDescription=function(t,i,a){if(!this.getBackend().getOriginalAttributes)return console.log("Backend without original attributes on form: "+t.form,this.getBackend()),void i.apply(a,[""]);var n=this.getBackend().getOriginalAttributes(),r=e.Cmdbuild.dataModel.getValue(t.form,t.field);this.getDescription(t,n,r,function(e){i.apply(a,[e])},this)},this.getDescription=function(t,i,a,n,r){for(var d=void 0,l=0;l<i.length;l++)if(i[l].name==t.field){d=i[l];break}d&&a?e.Cmdbuild.utilities.getFieldDescription(d,a,function(e){n.apply(r,[e])}):n.apply(r,[a||""])},this.change=function(t){var i=[];for(var a in t.data){var n=e.Cmdbuild.utilities.getHtmlFieldValue("#"+t.form+"_"+a),r=e.Cmdbuild.utilities.getHtmlFieldInteractivity("#"+t.form+"_"+a);if(n)t.data[a]=n;else if(r!=e.Cmdbuild.global.READ_WRITE_REQUIRED&&""===n)t.data[a]=n;else if(r==e.Cmdbuild.global.READ_WRITE_REQUIRED){var d=t.formObject.getBackend().getAttributes(),l=a;e.each(d,function(e,t){t._id==a&&(l=t.description)}),i.push({field:l,errorType:e.Cmdbuild.global.NOVALUEONREQUIREDFIELD})}}return i},this.show=function(){if(this.initializationPhase=!0,e.Cmdbuild.dataModel.evaluateXmlAttributes(this.param.form,this.getBackend().getAttributes()),this.noGroupDefinition(this.getBackend().getAttributes()),e.Cmdbuild.CqlManager.compile(this.param.form,this.getBackend().getAttributes()),this.param.emptyForm&&"true"==this.param.emptyForm){var i={},a=this.getBackend().getAttributes();e.each(a,function(e,t){t.defaultValue?i[t.name]=t.defaultValue:i[t.name]=void 0}),this.setBackendData(i)}try{e.Cmdbuild.dataModel.push({form:this.param.form,type:"form",data:this.getBackendData()});var n=e("#"+this.param.container)[0];if(0==this.getBackend().getAttributes().length)return void(n.innerHTML="");var r="",d={};this.lookUps=[];for(var a=this.getBackend().getAttributes(),l=0;l<a.length;l++){var s=a[l],o="true"!=this.param.noGroup&&s.group?s.group:t,m=d[o];m||(m=[],d[o]=m),m.push({form:this.param.form,withReturn:!0,card:this.getBackendData(),attribute:s})}var u="tabbed"+this.param.form;if(Object.keys(d).length>1)r+=this.headTabbed(u,d),r+=this.tabsTabbed(u,d),r+=this.footTabbed();else{var c=Object.keys(d)[0];r+=this.fieldsTabbed(d[c])}var g=e.Cmdbuild.elementsManager.getElement(this.param.form),b=this.getBackend().widgets,h=e.Cmdbuild.utilities.getWidgetsFromXML(g);h&&h.length&&(void 0===b&&(b=[]),e.each(h,function(e,t){b.push(t)}),this.getBackend().widgets=b),b&&b.length&&(e.Cmdbuild.widgets.prepareFields(b),r+=e.Cmdbuild.standard.widgetDiv.getWidgetDiv({container:this.param.container,form:this.param.form,readOnly:this.param.readonly,widgets:b}),e.Cmdbuild.widgets.evaluateCqlFields(this.param.form,b,!0)),r+=this.createAllLookUps(),r+=e.Cmdbuild.utilities.getButtonsFromXML(g),r+="<br/>",e.Cmdbuild.eventsManager.deferEvents(),r+=e.Cmdbuild.elementsManager.insertChildren(g);var n=e("#"+this.param.container)[0];n.innerHTML=r,Object.keys(d).length>1&&e("#"+u).tabs(),e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents(),this.param.onInitComplete&&window[this.param.onInitComplete](),e("#"+this.param.container+" input[disabled]").each(function(t,i){e(i).attr("title",e(i).attr("value"))}),b&&e.Cmdbuild.widgets.initialize(this.param.form,b);var p=this;this.TM=setTimeout(function(){p.initializationPhase=!1},500)}catch(f){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.form.show"),f}},this.headTabbed=function(e,i){var a="";a+="<div id='"+e+"'><ul>";var n=1;for(var r in i)if(r!=t){var d=e+"-tab-"+n++;a+="<li><a href='#"+d+"'>"+r+"</a></li>"}return a+="</ul>"},this.tabsTabbed=function(e,i){var a="",n=1;for(var r in i)if(r!=t){var d=e+"-tab-"+n++;a+="<div id='"+d+"'>",a+=this.fieldsTabbed(i[r]),a+="</div>"}return a},this.fieldsTabbed=function(e){for(var t="",i=0;i<e.length;i++)t+=this.fieldToHtml(e[i]);return t+="<div class='cmdbuildClear'></div>"},this.footTabbed=function(){var e="";return e+="</div>"},this.fieldToHtml=function(t){var i="";if(t.attribute.hidden){return"";var a,n}switch(t.attribute.type.toLowerCase()){case"title":var a=t.attribute.name,n=this.createXmlTitle(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"paragraph":var a=t.attribute.name,n=this.createXmlParagraph(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"timestamp":case"time":case"datetime":case"date":var a=t.attribute.name,n=this.createXmlDate(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"reference":var a=t.attribute.name,n=this.createXmlReference(t.form+"_"+a,t.form,t.attribute,t.card,this.param.container);i+=e.Cmdbuild.elementsManager.toHtml(n),this.lookUps.push(t.form+"_"+a);break;case"lookup":var a=t.attribute.name,n=this.createXmlLookup(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"select":var a=t.attribute.name,n=this.createXmlSelect(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"decimal":var a=t.attribute.name,n=this.createXmlDecimal(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"integer":var a=t.attribute.name,n=this.createXmlInteger(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"string":var a=t.attribute.name,n=this.createXmlString(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"text":var a=t.attribute.name,n=this.createXmlText(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"boolean":var a=t.attribute.name,n=this.createXmlBoolean(t.form+"_"+a,t.form,t.attribute,t.card);i+=e.Cmdbuild.elementsManager.toHtml(n);break;case"double":var a=t.attribute.name,n=this.createXmlDouble(t.form+"_"+a,t.form,t.attribute,t.card);
i+=e.Cmdbuild.elementsManager.toHtml(n);break;default:i+="<p><b>"+t.attribute.type+"</b> not in forms elements</p>"}return i},this.interactivityType=function(t){return"true"==this.param.readonly?e.Cmdbuild.global.READ_ONLY:(t.interactivity||(t.mandatory?t.interactivity=e.Cmdbuild.global.READ_WRITE_REQUIRED:t.interactivity=e.Cmdbuild.global.READ_WRITE),t.interactivity)},this.createXmlHidden=function(e,t,i,a){var n="<input";n+=" id='"+e+"' ",n+=" fieldName='"+i.name+"' ",n+=" text='"+(a[i.name]||"")+"' ",n+=" class='ui-widget-content ui-corner-all' ",n+=" withReturn='true' ",n+=">",n+="</input>";var r=new DOMParser;return xDoc=r.parseFromString(n,"text/xml"),xDoc.documentElement},this.createXmlBoolean=function(e,t,i,a){var n="<checkbox";n+=" label='"+i.description+"' ",n+=" interactivity='"+this.interactivityType(i)+"' ",n+=" id='"+e+"' ",n+=" fieldName='"+i.name+"' ",n+=" text='"+(a[i.name]||"")+"' ",n+=" class='ui-widget-content ui-corner-all' ",n+=" withReturn='true' ",n+=">",n+="</checkbox>";var r=new DOMParser;return xDoc=r.parseFromString(n,"text/xml"),xDoc.documentElement},this.createXmlSelect=function(e,t,i,a){var n="<select ";n+=" label='"+i.description+"' ",n+=" interactivity='"+this.interactivityType(i)+"' ",n+=" id='"+e+"' ",n+=" fieldName='"+i.name+"' ",n+=" class='ui-widget-content ui-corner-all' ",n+=" withReturn='true' ",n+=">",n+="<params>",n+="<backend>"+i.backend+"</backend>",n+="<className>GUIForm</className>",n+="</params>",n+="<onChange>",n+="<command>pippo</command>",n+="</onChange>",n+="</select>";var r=new DOMParser;return xDoc=r.parseFromString(n,"text/xml"),xDoc.documentElement},this.createXmlTitle=function(t,i,a,n){var r="<h2";r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" class='ui-widget-content ui-corner-all' ",r+=" withReturn='true' ",r+=">",r+="</h2>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createXmlParagraph=function(t,i,a,n){var r="<p";r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" withReturn='true' ",r+=">",r+="</p>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createXmlInteger=function(t,i,a,n){var r="<integer";r+=" label='"+a.description+"' ",r+=" interactivity='"+this.interactivityType(a)+"' ",r+=" id='"+t+"' ",r+=" fieldName='"+a.name+"' ",r+=" formName='"+i+"' ",r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" class='alignLeft ui-widget-content ui-corner-all' ",r+=" withReturn='true' ",r+=">",r+="</integer>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createXmlDecimal=function(t,i,a,n){var r="<input";r+=" label='"+a.description+"' ",r+=" interactivity='"+this.interactivityType(a)+"' ",r+=" id='"+t+"' ",r+=" fieldName='"+a.name+"' ",r+=" formName='"+i+"' ",r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" class='alignLeft ui-widget-content ui-corner-all' ",r+=" withReturn='true' ",r+=">",r+="</input>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createXmlString=function(t,i,a,n){var r="<input";r+=" label='"+a.description+"' ",r+=" interactivity='"+this.interactivityType(a)+"' ",r+=" id='"+t+"' ",r+=" fieldName='"+a.name+"' ",r+=" formName='"+i+"' ",r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" class='ui-widget-content ui-corner-all "+a["class"]+"' ",r+=" withReturn='true' ",a.length&&(r+=" maxlength='"+a.length+"' "),r+=">",r+="</input>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createXmlText=function(t,i,a,n){var r=e.Cmdbuild.utilities.escapeHtml(n[a.name])||"",d="HTML"==a.editorType,l="<textarea";l+=" label='"+a.description+"' ",l+=" interactivity='"+this.interactivityType(a)+"' ",l+=" id='"+t+"' ",l+=" text='"+r+"' ",l+=" fieldName='"+a.name+"' ",l+=" formName='"+i+"' ",l+=" class='ui-widget-content ui-corner-all' ",l+=" rows='6' ",l+=" withReturn='true' ",a.length&&(l+=" maxlength='"+a.length+"' "),l+=">",l+="<params>",d&&(l+="<isHtml>true</isHtml>"),l+="<rows>4</rows>",l+="<rawText>"+r+"</rawText>",l+="</params>",l+="</textarea>";var s=new DOMParser;return xDoc=s.parseFromString(l,"text/xml"),xDoc.documentElement},this.createXmlDate=function(e,t,i,a){var n="<date";n+=" label='"+i.description+"' ",n+=" interactivity='"+this.interactivityType(i)+"' ",n+=" id='"+e+"' ",n+=" text='"+(a[i.name]||"")+"' ",n+=" fieldName='"+i.name+"' ",n+=" formName='"+t+"' ",n+=" class='ui-widget-content ui-corner-all' ",n+=" withReturn='true' ",n+=">",n+="<params><type>"+i.type+"</type></params>",n+="</date>";var r=new DOMParser;return xDoc=r.parseFromString(n,"text/xml"),xDoc.documentElement},this.createXmlLookup=function(e,t,i,a){var n="<lookup";n+=" label='"+i.description+"' ",n+=" interactivity='"+this.interactivityType(i)+"' ",n+=" id='"+e+"' ",n+=" fieldName='"+i.name+"' ",n+=" formName='"+t+"' ",n+=" class='ui-widget-content ui-corner-all' ",n+=" withReturn='true' ",n+=">",n+="<params>",n+="<lookupName>"+i.lookupType+"</lookupName>",a[i.name]&&(n+="<value>"+a[i.name]+"</value>"),n+="<backend>Lookup</backend>",n+="</params>",n+="</lookup>";var r=new DOMParser;return xDoc=r.parseFromString(n,"text/xml"),xDoc.documentElement},this.createXmlReference=function(t,i,a,n,r){var d="<reference";d+=" label='"+a.description+"' ",d+=" interactivity='"+this.interactivityType(a)+"' ",d+=" id='"+t+"' ",d+=" fieldName='"+a.name+"' ",d+=" formName='"+i+"' ",d+=" class='ui-widget-content ui-corner-all' ",d+=" withReturn='true' ",d+=">",d+="<params>",d+="<className>"+a.targetClass+"</className>",d+="<formNRows>"+a.formNRows+"</formNRows>",n[a.name]&&(d+="<value>"+n[a.name]+"</value>"),d+="<container>"+r+"</container>",e.Cmdbuild.dataModel.isAProcess(a.targetClass)?(d+="<backend>ReferenceActivityList</backend>",d+="<isProcess>true</isProcess>"):(d+="<backend>CardList</backend>",d+="<isProcess>false</isProcess>"),d+="</params>",d+="</reference>";var l=new DOMParser;return xDoc=l.parseFromString(d,"text/xml"),xDoc.documentElement},this.createXmlDialog=function(e){var t="<dialog id='"+e+"_lookupDialog'></dialog>",i=new DOMParser;return xDoc=i.parseFromString(t,"text/xml"),xDoc.documentElement},this.createXmlDouble=function(t,i,a,n){var r="<input";r+=" label='"+a.description+"' ",r+=" interactivity='"+this.interactivityType(a)+"' ",r+=" id='"+t+"' ",r+=" fieldName='"+a.name+"' ",r+=" formName='"+i+"' ",r+=" text='"+(e.Cmdbuild.utilities.escapeHtml(n[a.name])||"")+"' ",r+=" class='alignLeft ui-widget-content ui-corner-all' ",r+=" withReturn='true' ",r+=">",r+="</input>";var d=new DOMParser;return xDoc=d.parseFromString(r,"text/xml"),xDoc.documentElement},this.createAllLookUps=function(){for(var t="",i=0;i<this.lookUps.length;i++){var a=this.createXmlDialog(this.lookUps[i]);t+=e.Cmdbuild.elementsManager.toHtml(a)}return t},this.noGroupDefinition=function(e){if(!e)return void console.log("Error no attributes on form :"+this.param.form);for(var t=!1,a=0;a<e.length;a++)if(e[a].group){t=!0;break}if(t)for(var a=0;a<e.length;a++)e[a].group||(e[a].group=i)},this.getBackend=function(){return this.backend},this.setBackend=function(e){this.backend=e},this.getBackendData=function(){var e=this.getBackend();return e.getData?e.getData():(console.warn("Missing getData method for backend "+this.param.backend),e.data)},this.setBackendData=function(e){var t=this.getBackend();t.setData?t.setData(e):(console.warn("Missing setData method for backend "+this.param.backend),t.data=e)}};e.Cmdbuild.standard.form=a}(jQuery),function(e){var t=function(){this.param=void 0,this.init=function(t){try{this.param=t,this.show()}catch(i){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.init"),i}},this.show=function(){try{var t=e.Cmdbuild.elementsManager.getElement(this.param.form);e.Cmdbuild.eventsManager.deferEvents();var i="";i+=e.Cmdbuild.elementsManager.insertChildren(t);var a=e("#"+this.param.container)[0];i+="<div id='container'>",i+="<style> #graph-container { top: 0; bottom: 0; left: 0; right: 0; position: absolute;} </style>",i+="<div id='graph-container'></div></div>",a.innerHTML=i,e.Cmdbuild.scriptsManager.push({script:"graph",id:"graph-container",className:this.param.className,cardId:this.param.cardId}),e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents()}catch(n){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.show"),n}}};e.Cmdbuild.standard.graph=t}(jQuery),function(e){var t=13,i=function(){this.currentPage=0,this.nRows=10,this.paginationSettings={},this.checked={},this.bkChecked={},this.config={},this.init=function(t){if(this.config=t,t.selectedItemId){var i=e.Cmdbuild.dataModel.resolveVariable(this.config.selectedItemId);t.positionOf=i}var a=e.Cmdbuild.utilities.getBackend(t.backend);this.backend=new a(this.config,this.onBackendLoaded,this)},this.onBackendLoaded=function(){var i=this.config;this.bkChecked=e.Cmdbuild.utilities.clone(this.checked),this.id=i.form;var a=e.Cmdbuild.elementsManager.getElement(this.id);e.Cmdbuild.elementsManager.getRowButtons(a,i),e.Cmdbuild.elementsManager.getColumnsCommands(a,i);var n=e.Cmdbuild.utilities.getFields(a);n&&n.fields&&(n.form=this.id,e.Cmdbuild.dataModel.putFormFields(n)),this.onDblClick=e.Cmdbuild.elementsManager.getEvent("onDblClick",a),this.paginationSettings={nRows:i.nRows||nRows,nTotalRows:0,firstRow:0,condition:i.condition,hookParent:"true"===i.hookParent,parent:i.parent,singleSelect:1==i.singleSelect?!0:!1,onClick:e.Cmdbuild.elementsManager.getEvent("onClick",a),onChange:e.Cmdbuild.elementsManager.getEvent("onChange",a),className:i.className,cardId:i.cardId,allowSorting:i.allowSorting&&"false"==i.allowSorting?!1:!0,allowScrollX:i.allowScrollX&&"false"==i.allowScrollX?!1:!0,fixedLeftColumns:i.fixedLeftColumns?i.fixedLeftColumns:0,fixedRightColumns:i.fixedRightColumns?i.fixedRightColumns:0,onInitComplete:i.onInitComplete?i.onInitComplete:null,rawParam:i};var r="true"==i.withComboProcesses?this.gridHeader(this.id):"";"true"==i.lookup&&(r+=this.gridButtons(this.id)),r+="<table id='"+this.id+"' class='display' width='100%'></table>",e.Cmdbuild.eventsManager.deferEvents();var d=e("#"+i.container)[0];r+=e.Cmdbuild.elementsManager.insertChildren(a),"false"!=i.navigation&&(r+=this.gridButtons(this.id)),d.innerHTML=r,e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents();var l=this.id;e("#"+this.id+"_filtertext").keypress(function(i){return i.which==t?(e.Cmdbuild.standard.grid.onFilter(l),!1):void 0}),this.chargeFilter()},this.reset=function(e){alert("grid reset "+e.type+" "+e.form)},this.change=function(e){alert("grid change "+e.type+" "+e.form)},this.chargeFilter=function(){this.paginationSettings.backend=this.backend;var t=this.paginationSettings.rawParam;t.grid=this,t.fieldName&&t.formName?e.Cmdbuild.CqlManager.resolve(t.formName,t.fieldName,this.show,this):this.show("")},this.show=function(t){var i=this.paginationSettings.backend;i.noValidFilter=void 0===t,this.paginationSettings.backend=this.backend;try{this.updateFirstRowFromSelectedItem();var a=this.paginationSettings.rawParam;a.grid=this,a.fieldName&&a.formName&&t&&(this.paginationSettings.backend.filter.CQL=t),e.Cmdbuild.dataModel.evaluateXmlAttributes(this.id,this.paginationSettings.backend.getAttributes()),this.showAttributes(a);var n=this,r=a.sort?this.getIndexColumn(a.sort):this.getFirstValidColumn(),d=a.direction||"asc",l=void 0,s=void 0,o=void 0;a.scroll&&(l=a.scrollHeight+"px",s=!0,o=!1);var m=e("#"+this.id).dataTable({scrollY:l,scrollCollapse:s,paging:o,pageLength:n.nRows,lengthChange:!1,bProcessing:!0,bServerSide:!0,searching:!1,paging:!1,scrollX:n.paginationSettings.allowScrollX,info:!1,ordering:n.paginationSettings.allowSorting,aaSorting:[[r,d]],ajax:function(t,i,a){var r=n.getParamFormLoadData(a);n.paginationSettings.backend.loadData(r,function(){var t={data:n.getData()};if(i(t),n.convertReferencedValues(),t.data&&t.data.length){var a=0;if(n.paginationSettings.rawParam.selectedItemId){var r=this.paginationSettings.backend.positions,d=this.paginationSettings.rawParam.selectedItemId;if(r&&d){var l=r[d];if(l){var s=this.paginationSettings.nRows;a=l%s,this.paginationSettings.rawParam.selectedItemId=void 0}}}var o=e("#"+n.id+' tbody tr:not(".cmdbuildGroupByHeader"):eq('+a+")"),m=e("#"+n.id).DataTable();n.paginationSettings.hookParent&&n.paginationSettings.parent.getSelection?n.selectRows(n.paginationSettings.parent.getSelection()):n.selectRow(n.id,m,o,a,!1),n.onLoad(),n.disableRowButtons()}else e.Cmdbuild.dataModel.setCurrentIndex(n.id,-1),n.onLoad()},n)},columns:n.paginationSettings.attributesInGrid,columnDefs:n.getNoAttributeColumns(),fnInitComplete:n.paginationSettings.onInitComplete?e.Cmdbuild.dataModel.resolveVariable(n.paginationSettings.onInitComplete):null,drawCallback:function(e){n.drawCallback(this,n,a,e)}});if(a.groupBy){var u=e("#"+this.id).DataTable();u.columns([0]).visible(!1,!1),u.order([[0,"asc"]])}new e.fn.dataTable.FixedColumns(m,{iLeftColumns:n.paginationSettings.fixedLeftColumns,iRightColumns:n.paginationSettings.fixedRightColumns}),m.on("order.dt",function(){e(e.fn.dataTable.tables(!0)).DataTable().columns.adjust()}),e("#"+this.id+" tbody").on("click","tr",function(t){var i=e(this).parents("table");n.id=i.attr("id");var r=e("#"+n.id).DataTable();(!e(this).hasClass("selected")||n.paginationSettings.hookParent)&&n.selectRow(a.form,r,e(this),r.row(this).index(),t.ctrlKey),e.Cmdbuild.eventsManager.onEvent(n.paginationSettings.onClick)}),this.onDblClick&&e("#"+n.id+" tbody").on("dblclick","tr",function(){e.Cmdbuild.eventsManager.executeEvent(n.onDblClick)}),e("#"+this.id+" tbody").on("click","span",function(t){var i=e(this).parents("table");n.id=i.attr("id");var r=e("#"+n.id).DataTable(),d=e(this).parents("tr");n.selectRow(a.form,r,d,r.row(d).index(),t.ctrlKey);var l=jQuery.parseJSON(e(this).attr("method"));e.Cmdbuild.eventsManager.onEvent(l)})}catch(c){throw e.Cmdbuild.errorsManager.log(c),c}},this.disableRowButtons=function(){var t=this.id,i=0,a=this.paginationSettings.backend;e("#"+t+" tbody tr").each(function(t){if(!e(this).hasClass("cmdbuildGroupByHeader")&&a.disableRowButtons){for(var n=a.disableRowButtons(i),r=0;r<n.length;r++){var d=e(this).find("."+n[r]);e(d).removeClass(n[r])}i++}})},this.onLoad=function(){this.paginationSettings.hookParent&&this.paginationSettings.parent.onLoad&&this.paginationSettings.parent.onLoad()},this.convertReferencedValues=function(){for(var t=e("#"+this.id).DataTable(),i=this.paginationSettings.backend,a=i.getData(),n=0;n<a.length;n++)for(var r=0;r<this.paginationSettings.attributesInGrid.length;r++)this.convertReferencedValue(a,t,n,r)},this.convertReferencedValue=function(t,i,a,n){var r=t[a],d=this.paginationSettings.attributesInGrid[n],l=r[d.name];d&&l?e.Cmdbuild.utilities.getFieldDescription(d,l,function(e){i.cell(a,n).data(e),i.columns.adjust()}):(i.cell(a,n).data(l||""),i.columns.adjust())},this.addColumnsCommands=function(){var t=this.paginationSettings.rawParam.columnsCommands,i=this,a=[];return e.each(t,function(e,t){var n=i.getIndexColumn(t.attribute);a.push({targets:n,mRender:function(e,i,a){var n="";if(e){var r=t.tooltip?" title = '"+t.tooltip+"' ":"";n="<span "+r+" class='commandcell "+t.icon+"' method='"+JSON.stringify(t.onClick)+"'>"+e+"</span>"}return n}})}),a},this.drawCallback=function(t,i,a,n){if(a.groupBy){var r=t.api(),d=r.rows({page:"current"}).nodes(),l=null;r.column(0,{page:"current"}).data().each(function(t,i){l!==t&&(e(d).eq(i).before('<tr class="cmdbuildGroupByHeader"><td colspan="5">'+t+"</td></tr>"),l=t)})}},this.selectRows=function(t){for(var i=e("#"+this.id).DataTable(),a=this.paginationSettings.backend.getData(),n=0;n<a.length;n++){var r=a[n],d=i.row(n).node();t[r.id]?e(d).addClass("selected"):e(d).removeClass("selected")}},this.selectRow=function(t,i,a,n,r){e.Cmdbuild.dataModel.setCurrentIndex(t,n),i.$("tr.selected").removeClass("selected"),a.addClass("selected"),this.paginationSettings.onChange&&(this.paginationSettings.onChange.addSelection=r,e.Cmdbuild.eventsManager.onEvent(this.paginationSettings.onChange))},this.getNoAttributeColumns=function(){for(var t=[],i=this.paginationSettings.backend.getAttributes(),a=0,n=0;i&&n<i.length;n++){var r=i[n];if(r.displayableInList){if("IMAGEBUTTON"==r.type){var d=r.tooltip?" title = '"+r.tooltip+"' ":"";t.push({width:20,targets:a,data:null,title:"&nbsp;",orderable:!1,defaultContent:"<span "+d+" class='"+r.className+"' method='"+r.onClick+"'></span>"})}else if("ROWSELECTIONCHECK"==r.type){var l=this,d=r.tooltip?" title = '"+r.tooltip+"' ":"";t.push({width:20,targets:a,data:null,title:"&nbsp;",orderable:!1,render:function(e,t,i,a){var n=e[0]?" checked ":"";return"<input name='rowSelectionCheck' "+d+" type='checkbox' "+n+" onclick='$.Cmdbuild.standard.grid.clickOnCheck(this, \""+l.id+"\")'>"}})}a++}}var s=this.addColumnsCommands();return e.merge(t,s)},this.getFirstValidColumn=function(){for(var e=0;e<this.paginationSettings.attributesInGrid.length;e++){var t=this.paginationSettings.attributesInGrid[e].type;if("IMAGEBUTTON"!=t&&"ROWSELECTIONCHECK"!=t)return e}},this.showAttributes=function(t){try{t.rowButtons&&e.Cmdbuild.elementsManager.loadIconButtons(this.paginationSettings.backend.getAttributes(),t.rowButtons,t.positionButtons),"true"===t.selection&&e.Cmdbuild.elementsManager.pushSelectionCheck(this.paginationSettings.backend.getAttributes(),"left"),this.paginationSettings.attributesInGrid=[];for(var i=0;i<this.paginationSettings.backend.getAttributes().length;i++){var a=this.paginationSettings.backend.getAttributes()[i];a.displayableInList&&this.paginationSettings.attributesInGrid.push({name:a.name,title:a.description,tooltip:a.tooltip,type:a.type,length:a.length,targetClass:a.targetClass,lookupType:a.lookupType})}}catch(n){e.Cmdbuild.errorsManager.log(n)}},this.getIndexColumn=function(e){for(var t=0;t<this.paginationSettings.attributesInGrid.length;t++)if(this.paginationSettings.attributesInGrid[t].name==e)return t;return 0},this.getParamFormLoadData=function(e){return param=this.paginationSettings,param.sort=this.paginationSettings.attributesInGrid[e.aaSorting[0][0]].name,param.direction="asc"==e.aaSorting[0][1]?"ASC":"DESC",param.form=this.id,param},this.getData=function(){try{"true"===this.paginationSettings.rawParam.selectionDefault&&this.selectAll();var t=this.paginationSettings.backend,i=t.getData();e.Cmdbuild.dataModel.push({form:this.id,type:"grid",currentIndex:t.getTotalRows()>0?0:-1,data:i});for(var a=[],n=0;n<i.length;n++){for(var r=i[n],d=[],l=0;l<this.paginationSettings.attributesInGrid.length;l++){var s=void 0;s="selectionCheck"==this.paginationSettings.attributesInGrid[l].name?this.checked[r._id]:this.getFieldValue(r,this.paginationSettings.attributesInGrid[l]),d.push(s)}a.push(d)}return this.paginationSettings.nTotalRows=t.getTotalRows(),this.enableGridButtons(this.id),this.setPageCount(this.id),a}catch(o){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.grid.getData "+o.message),o}},this.getFieldValue=function(t,i){return t[i.name]?"lookup"==i.type?"":"reference"==i.type?"":-1!=["date","time","timestamp","dateTime"].indexOf(i.type)?e.Cmdbuild.utilities.convertDateDB2GUI(t[i.name],i.type):t[i.name]||"":""},this.gridHeader=function(t){var i="<div class='cmdbuildGridHeaderWrapper'>",a=t+"_processStatuses",n=" id='"+a+"' class='cmdbuildGridProcessStatuses' ",r=" onChange='$.Cmdbuild.standard.grid.onSelectStatus(\""+a+'", "'+this.id+"\")'";i+="<select "+n+r+">",i+="</select>";var d={script:"select",id:a,backend:"Select",processName:this.paginationSettings.className,value:"$fromBackend"};return e.Cmdbuild.scriptsManager.push(d),i+="</div>"},this.newgridButtons=function(e){var t="<div class='cmdbuildGridNavigationWrapper'>";return t+="<div class='cmdbuildGridFilterContainer'>",t+="<!--[if IE]><br/><input type='text' ",t+=" size='20' value='Ignore field IE bug fix'",t+="/><br/><![endif]-->",t+="<input type='text' id='"+e+"_filtertext' />",t+=this.gridButton(e+"_filter","ui-icon-search",'$.Cmdbuild.standard.gridMenu.onFilter("'+e+'")'),t+=this.gridButton(e+"_clearFilter","ui-icon-closethick",'$.Cmdbuild.standard.gridMenu.onClearFilter("'+e+'")'),t+="</div>",t+="<div class='cmdbuildGridNavigationContainer'>",t+=this.gridButton(e+"_init","ui-icon-arrowthickstop-1-w",'$.Cmdbuild.standard.gridMenu.onNavigate("begin", "'+e+'")'),t+=this.gridButton(e+"_previous","ui-icon-arrowthick-1-w",'$.Cmdbuild.standard.gridMenu.onNavigate("previous", "'+e+'")'),t+=this.gridButton(e+"_next","ui-icon-arrowthick-1-e",'$.Cmdbuild.standard.gridMenu.onNavigate("next", "'+e+'")'),t+=this.gridButton(e+"_end","ui-icon-arrowthickstop-1-e",'$.Cmdbuild.standard.gridMenu.onNavigate("end", "'+e+'")'),t+="<p id='"+e+"_pageCount' class='cmdbuildGridNavigationCount'>Page 1 of 123</p>",t+="</div>",t+='<div class="cmdbuildClear"></div>',t+="</div>"},this.gridButtons=function(e){var t="<div class='cmdbuildGridNavigationWrapper'>";return t+="<div class='cmdbuildGridFilterContainer'>",t+="<input type='text' id='"+e+"_filtertext' />",t+=this.gridButton(e+"_filter","ui-icon-search",'$.Cmdbuild.standard.grid.onFilter("'+e+'")'),t+=this.gridButton(e+"_clearFilter","ui-icon-closethick",'$.Cmdbuild.standard.grid.onClearFilter("'+e+'")'),t+="</div>",t+="<div class='cmdbuildGridNavigationContainer'>",t+=this.gridButton(e+"_init","ui-icon-arrowthickstop-1-w",'$.Cmdbuild.standard.grid.onNavigate("begin", "'+e+'")'),t+=this.gridButton(e+"_previous","ui-icon-arrowthick-1-w",'$.Cmdbuild.standard.grid.onNavigate("previous", "'+e+'")'),t+=this.gridButton(e+"_next","ui-icon-arrowthick-1-e",'$.Cmdbuild.standard.grid.onNavigate("next", "'+e+'")'),t+=this.gridButton(e+"_end","ui-icon-arrowthickstop-1-e",'$.Cmdbuild.standard.grid.onNavigate("end", "'+e+'")'),t+="<p id='"+e+"_pageCount' class='cmdbuildGridNavigationCount'>Page 1 of 123</p>",t+="</div>",t+='<div class="cmdbuildClear"></div>',t+="</div>"},this.enableGridButtons=function(t){var i=parseInt(this.paginationSettings.firstRow),a=parseInt(this.paginationSettings.nRows),n=parseInt(this.paginationSettings.nTotalRows);e("#"+t+"_init").button("option","disabled",0==i),e("#"+t+"_previous").button("option","disabled",0==i),e("#"+t+"_next").button("option","disabled",i+a>=n),e("#"+t+"_end").button("option","disabled",i+a>=n)},this.setPageCount=function(t){var i=parseInt(this.paginationSettings.firstRow),a=parseInt(this.paginationSettings.nRows),n=parseInt(this.paginationSettings.nTotalRows),r=e.Cmdbuild.utilities.formatVarString(e.Cmdbuild.global.GRIDROWSCOUNT,parseInt(i/a)+1,parseInt((n+a-1)/a),n);e("#"+t+"_pageCount").html(r)},this.gridButton=function(t,i,a){return e.Cmdbuild.elementsManager.makeServiceButton("cmdbuildButton",t,i,a)},this.getBackend=function(){return this.paginationSettings.backend},this.selectAll=function(){var e=this.paginationSettings.backend;this.checked={};for(var t=0;t<e.getTotalRows();t++)this.checked[e.data[t]._id]="true"},this.updateFirstRowFromSelectedItem=function(){var e=this.paginationSettings.backend.positions,t=this.paginationSettings.rawParam.selectedItemId;if(e&&t){var i=e[t];if(i){var a=this.paginationSettings.nRows,n=Math.floor(i/a)*a;this.paginationSettings.firstRow=n}}}};e.Cmdbuild.standard.grid=i,e.Cmdbuild.standard.grid.onSelectStatus=function(t,i){var a=e.Cmdbuild.utilities.getHtmlFieldValue("#"+t),n=e.Cmdbuild.dataModel.forms[i],r=n.getBackend();if(r.setFilter){r.setFilter({flowStatus:a});var d=e("#"+i).DataTable();d.ajax.reload(function(e){})}else e.Cmdbuild.errorsManager.log("The method setFilter is not defined on the grid backend")},e.Cmdbuild.standard.grid.onFilter=function(t){var i=e.Cmdbuild.dataModel.forms[t];i.paginationSettings.firstRow=0;var a=e("#"+t+"_filtertext").val();i.paginationSettings.backend.filter.query=e.trim(a);var n=e("#"+t).DataTable();n.ajax.reload(function(e){})},e.Cmdbuild.standard.grid.onClearFilter=function(t){var i=e.Cmdbuild.dataModel.forms[t];i.paginationSettings.firstRow=0,i.paginationSettings.backend.filter.query="",e("#"+t+"_filtertext").val("");var a=e("#"+t).DataTable();a.ajax.reload(function(e){})},e.Cmdbuild.standard.grid.cancelSelection=function(t){var i=e.Cmdbuild.dataModel.forms[t];i&&(i.checked=e.Cmdbuild.utilities.clone(i.bkChecked))},e.Cmdbuild.standard.grid.clearSelection=function(t){var i=e.Cmdbuild.dataModel.forms[t];i&&(i.checked={})},e.Cmdbuild.standard.grid.getChecked=function(t){var i=e.Cmdbuild.dataModel.forms[t];return i?i.checked:{}},e.Cmdbuild.standard.grid.clickOnCheck=function(t,i){var a=t.checked,n=e(t).parents("table"),r=n.attr("id"),d=e("#"+r).DataTable(),l=e(t).parents("tr"),s=e.Cmdbuild.dataModel.forms[i];s.selectRow(i,d,l,d.row(l).index());var o=e.Cmdbuild.dataModel.getValues(i),m=e(n).find("input[name='rowSelectionCheck']");s.paginationSettings.singleSelect&&(m.each(function(){this!=t&&e(this).attr("checked",!1)}),s.checked=[]),s.checked[o._id]=a},e.Cmdbuild.standard.grid.onNavigate=function(t,i){var a=e.Cmdbuild.dataModel.forms[i],n=parseInt(a.paginationSettings.firstRow),r=parseInt(a.paginationSettings.nRows),d=parseInt(a.paginationSettings.nTotalRows);switch(t){case"begin":n=0;break;case"end":var l=d-1;n=l>0?l:0;break;case"previous":var l=n-r;n=l>0?l:0;break;case"next":n+=r;break;default:n=0}a.paginationSettings.firstRow=n;var s=e("#"+i).DataTable();s.ajax.reload(function(e){})}}(jQuery),function(e){var t=function(t){this.param=t,this.lookupTree={},this.lookupValue={},this.init=function(){try{this.param.value&&(this.lookupValue[this.param.lookupName]=this.param.value),this.generateLookupTypeTree(this.param.lookupName)}catch(t){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.lookupField.init"),t}},this.generateLookupTypeTree=function(t,i){var a=this;e.Cmdbuild.utilities.proxy.getLookupType(t,{},function(n,r){var d={type:n.name,values:[]};n.parent&&(d.parent=n.parent),i&&(d.child=i),e.Cmdbuild.utilities.proxy.getLookupData(t,{active:!0},function(t,i){if(d.values=t,a.lookupTree[n.name]=d,n.parent&&a.lookupValue[n.name]){var r=a.lookupValue[n.name],l=e.grep(t,function(e){return e._id==r});l.length&&(a.lookupValue[l[0].parent_type]=l[0].parent_id)}n.parent?a.generateLookupTypeTree(n.parent,n.name):a.generateHTML()},this)},this)},this.generateHTML=function(){var t=e("#"+this.param.id),i=this.param.lookupName;if(this.param.readOnly)return void this.showReadOnlyLookup(i);if(!this.lookupTree[i])return void console.log("NOT FOUND : this.lookupTree["+i+"]");if(this.lookupTree[i].parent){if(t.attr("rel",this._getRelValueByType(i)),t.selectmenu("widget").addClass("selectmenu-newrow"),this.lookupValue[i]){var a=this.lookupTree[i].parent,n=this.lookupValue[a];this.updateChildSelect(i,n)}this.addParentSelect(this.lookupTree[this.param.lookupName].parent,t)}else this.addOptions(t,this.lookupTree[i].values)},this.addOptions=function(t,i){t.empty();var a=this,n=e("<option>");t.append(n),e.each(i,function(i,n){var r=e("<option>").attr("value",n._id).attr("entryValue",n._id);r.text(n.description),a.lookupValue[n._type]==n._id&&r.attr("selected","selected"),t.append(r)}),t.selectmenu("refresh")},this.addParentSelect=function(t,i){var a=this,n=this.lookupTree[t],r=e("<select>");r.attr("rel",this._getRelValueByType(t)),i.before(r),i.before("<div></div>"),r.selectmenu({change:function(e,t){a.updateChildSelect(n.child,t.item.value)}}),n.parent?selectfield.selectmenu().addClass("selectmenu-newrow"):this.addOptions(r,n.values)},this.updateChildSelect=function(t,i){var a=this.lookupTree[t],n=[],r=e("select[rel='"+this._getRelValueByType(t)+"']");e.each(a.values,function(e,t){t.parent_id==i&&n.push(t)}),this.addOptions(r,n)},this.showReadOnlyLookup=function(t){if(!e.isEmptyObject(this.lookupValue)){var i=this.lookupTree[t].values,a=this.lookupValue[t],n=this.getSelectedItem(i,a),r=e("#"+this.param.id);r.after(n.description),n.parent_type&&(r.after(" / "),this.showReadOnlyLookup(n.parent_type))}},this.getSelectedItem=function(t,i){var a;return e.each(t,function(e,t){t._id==i&&(a=t)}),a},this._getRelValueByType=function(e){return this.param.id+e},this.init()};e.Cmdbuild.standard.lookupField=t,e.Cmdbuild.standard.lookupField.setValue=function(t,i){var a=e("#"+t);a.val(""),a.selectmenu("refresh")},e.Cmdbuild.standard.lookupField.clearValue=function(t){var i=e("#"+t);i.val(""),i.selectmenu("refresh")}}(jQuery),function(e){var t="selectedNavItem",i="cmdbuild_navigation",a=function(){this.id=null,this.config={},this.backend=void 0,this.tree={},this.init=function(t){this.config=t,this.id=t.form,t.labelField||(t.labelField="_description"),t.idField||(t.idField="_id");var i=e.Cmdbuild.utilities.getBackend(t.backend);this.backend=new i(t,this.onInitComplete,this)},this.onInitComplete=function(){var e={},t=this;this.backend.loadData(e,function(){t.show()},this)},this.show=function(){var a=this.backend.getData();e.Cmdbuild.dataModel.push({form:this.id,type:"navigation",currentIndex:-1,data:a});try{this.organizeTree()}catch(n){e.Cmdbuild.errorsManager.popup(n)}var l=e("#"+this.config.container),s=this.generateUL("root",this.config.form,i);l.append(s),this.config.collapsible&&(d.walk(this.config.form),l.addClass("collapsibleNavigation")),r(this.config.form,0),l.children("ul").children("li:first-child").children("a:first-child").addClass(t)},this.organizeTree=function(){this.tree={};var t=this,i=this.config.parentField;if(!i){var a=new Error("Missing parentField parameter.");throw a.name="ConfigurationError",a}e.each(this.backend.getData(),function(e,a){var n=a[i];n||null!==n||(n="root"),-1===Object.keys(t.tree).indexOf(n.toString())&&(t.tree[n]=[]),t.tree[n].push(a)})},this.generateUL=function(i,a,d){var l=this,s="rel-itemid",o=this.config.labelField,m=this.config.idField,u=e("<ul></ul>");a&&u.attr("id",a),d&&u.addClass(d);var c=this.tree[i];return c&&e.each(c,function(i,a){var d=a[m],c=e("<li></li>"),g=e("<a></a>").attr("href","#").attr(s,d).text(a[o]).click(function(){var i=e(this);e("#"+l.config.container+" ."+t).removeClass(t),i.addClass(t);var a=n(l.backend.getData(),m,i.attr(s));return r(l.config.form,a),!1});c.append(g),-1!==Object.keys(l.tree).indexOf(d.toString())&&c.append(l.generateUL(d.toString())),u.append(c)}),u}},n=function(e,t,i){for(var a=0;a<e.length;a+=1)if(e[a][t]==i)return a},r=function(t,i){e.Cmdbuild.dataModel.setCurrentIndex(t,i)},d={collapse:function(e){e.slideToggle(500)},walk:function(t){var i=this;e("a","#"+t).each(function(){var t,a=e(this);a.parent();if(a.next().is("ul")){var n=a.next();t=e("<span></span>").addClass("navCommandIcon"),t.click(function(e){e.preventDefault(),i.collapse(n),t.toggleClass("active")})}else t=e("<span></span>").addClass("navBullet").html("&bull;");a.before(t)})}};e.Cmdbuild.standard.navigation=a}(jQuery),function(e){var t=function(){this.param=void 0,this.init=function(t){try{this.param=t,this.show()}catch(i){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.init"),i}},this.show=function(){try{e.Cmdbuild.eventsManager.deferEvents();var t=e("#"+this.param.dialog),i=e.Cmdbuild.elementsManager.getElement(this.param.form),a=e.Cmdbuild.elementsManager.insertChildren(i);t.html(a),t.dialog("option","dialogClass",e.Cmdbuild.global.getThemeCSSClass());var n=this.param.width,r=this.param.height;t.dialog("option","height",r||e.Cmdbuild.global.modalMaxHeight),t.dialog("option","width",n||e.Cmdbuild.global.modalMaxWidth),t.dialog("option","title",this.param.title).dialog("open"),e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents()}catch(d){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.div.show"),d}}};e.Cmdbuild.standard.popup=t}(jQuery),function($){var referenceField=function(param){this.param=param,this.backend=void 0,this.init=function(){try{var e=$.Cmdbuild.utilities.getBackend(param.backend);param.page=0,param.start=0,param.nRows=this.nrows(),this.backend=new e(param,this.loadReference,this)}catch(t){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.referenceField.init"),t}},this.loadReference=function(){if(this.param.readOnly)return void this.loadReadOnlyReference();
var e=$("#"+param.id),t=e.attr("formName"),i=e.attr("fieldName");$.Cmdbuild.CqlManager.resolve(t,i,function(e){return void 0==e||$.Cmdbuild.CqlManager.isUndefined(e)?void this.chargeEmpty():(e&&(this.param.filter={CQL:e},this.backend.filter=this.param.filter),void this.loadData(this))},this)},this.loadData=function(){this.backend.loadData(this.param,this.showReference,this)},this.nrows=function(){return this.param.formNRows&&"undefined"!=this.param.formNRows?this.param.formNRows:$.Cmdbuild.global.getMaxLookupEntries()},this.showReference=function(){var selectMenu=$("#"+this.param.id),bReference=this.backend.getTotalRows()>this.nrows();selectMenu.attr("reference",bReference?"true":"false"),bReference?this.param.value?this.chargeValue():this.chargeEmpty():this.chargeCombo(),bReference?selectMenu.selectmenu({open:function(event,ui){eval(param.eventSearch)}}):selectMenu.unbind("selectmenuopen")},this.inFilter=function(){if(!this.param.filter)return!0;for(var e=0;e<this.backend.data.length;e++)if(this.backend.data[e]._id==this.param.value)return!0;return!1},this.chargeEmpty=function(){var e=$("#"+this.param.id),t=[];t.push("<option></option>"),e.empty(),e.append(t.join("")).selectmenu(),e.val(""),this.fieldChanged(),e.selectmenu("refresh")},this.chargeValue=function(){var e=$("#"+this.param.id);$.Cmdbuild.dataModel.isAProcess(param.className)?$.Cmdbuild.utilities.proxy.getCardProcess(param.className,param.value,{},function(t,i){var a=[];a.push("<option selected entryValue='"+t._id+"' value='"+t._id+"'>"+t.Description+"</option>"),e.empty(),e.append(a.join("")).selectmenu(),e.val(t._id),this.fieldChanged(),e.selectmenu("refresh")},this):$.Cmdbuild.utilities.proxy.getCardData(param.className,param.value,{},function(t,i){var a=[];a.push("<option selected entryValue='"+t._id+"' value='"+t._id+"'>"+t.Description+"</option>"),e.empty(),e.append(a.join("")).selectmenu(),e.val(t._id),this.fieldChanged(),e.selectmenu("refresh")},this)},this.chargeCombo=function(){var e=[],t=$("#"+this.param.id),i=" entryValue='' ";e.push("<option "+i+"></option>");for(var a=0;a<this.backend.data.length;a++){var n=this.backend.data[a];i=" entryValue='"+n._id+"' value='"+n._id+"'",e.push("<option "+i+">"+n.Description+"</option>")}t.empty(),t.append(e.join("")).selectmenu(),t.val(this.param.value),this.fieldChanged(),t.selectmenu("refresh")},this.fieldChanged=function(){$.Cmdbuild.custom.commands&&$.Cmdbuild.custom.commands.fieldChanged?$.Cmdbuild.custom.commands.fieldChanged(this.param):$.Cmdbuild.standard.commands.fieldChanged(this.param)},this.clear=function(){if("true"==$("#"+this.param.id).attr("reference")){var e=[];e.push("<option entryValue=''></option>"),$("#"+this.param.id).append(e.join("")).selectmenu()}$("#"+this.param.id).val(""),this.fieldChanged(),$("#"+this.param.id).selectmenu("refresh")},this.loadReadOnlyReference=function(){if(this.param.value){var e=$("#"+this.param.id);$.Cmdbuild.dataModel.isAProcess(this.param.className)?$.Cmdbuild.utilities.proxy.getCardProcess(this.param.className,this.param.value,{},function(t,i){e.after(t.Description)},this):$.Cmdbuild.utilities.proxy.getCardData(this.param.className,this.param.value,{},function(t,i){e.after(t.Description)},this)}},this.init()};$.Cmdbuild.standard.referenceField=referenceField,$.Cmdbuild.standard.referenceField.onClearLookup=function(e){$("#"+e)[0].objectField.clear()},$.Cmdbuild.standard.referenceField.onSearchLookup=function(e,t){return $.Cmdbuild.standard.commands.navigate({container:t,form:e+"_dialog",dialog:e+"_lookupDialog",title:"Reference values",width:"90%"}),!0},$.Cmdbuild.standard.referenceField.onChangeLookup=function(e){var t=e.toExecCommand,i=$("#"+t),a=$.Cmdbuild.dataModel.getValue(t+"_dialogGrid","_id"),n=$.Cmdbuild.dataModel.getValue(t+"_dialogGrid","Description");if("true"==i.attr("reference")){var r=[];r.push("<option entryValue='"+a+"' value='"+a+"' selected>"+n+"</option>"),i.empty(),i.append(r.join("")).selectmenu()}i.val(a),i[0].objectField.fieldChanged(),i.selectmenu("refresh")},$.Cmdbuild.standard.referenceField.chargeLookup=function(e){var t=$("#"+e.id);t[0].objectField.loadReference()}}(jQuery),function($){var scripts={init:function(e){$.Cmdbuild.eventsManager.onEvent(e)},htmlText:function(e){$("#"+e.id).cleditor()},spinner:function(e){$("#"+e.id).spinner({spin:function(t,i){return i.value>10?($(this).spinner("value",10),!1):i.value<1?($(this).spinner("value",1),!1):void $.Cmdbuild.eventsManager.onEvent(e.spin)},change:function(t,i){return i.value>10?($(this).spinner("value",10),!1):i.value<1?($(this).spinner("value",1),!1):void $.Cmdbuild.eventsManager.onEvent(e.spin)}})},lookup:function(param){try{param.readOnly||($("#"+param.id).selectmenu(),$("#"+param.id).selectmenu({select:function(event,ui){var val=$.Cmdbuild.utilities.getHtmlFieldValue("#"+param.id);param.value=val,$.Cmdbuild.custom.commands&&$.Cmdbuild.custom.commands.fieldChanged?$.Cmdbuild.custom.commands.fieldChanged(param):$.Cmdbuild.standard.commands.fieldChanged(param);var onchange=$("#"+param.id).attr("onChange");eval(onchange)}}));var objectField=new $.Cmdbuild.standard.lookupField(param);$("#"+param.id)[0].objectField=objectField}catch(e){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.scripts.lookup "+e.message),e}},select:function(param){try{$("#"+param.id).selectmenu(),$("#"+param.id).selectmenu({select:function(event,ui){var val=$.Cmdbuild.utilities.getHtmlFieldValue("#"+param.id);param.value=val,$.Cmdbuild.custom.commands&&$.Cmdbuild.custom.commands.fieldChanged?$.Cmdbuild.custom.commands.fieldChanged(param):$.Cmdbuild.standard.commands.fieldChanged(param);var onchange=$("#"+param.id).attr("onChange");eval(onchange)}});var objectField=new $.Cmdbuild.standard.selectField(param);$("#"+param.id)[0].objectField=objectField}catch(e){$.Cmdbuild.errorsManager.log(e)}},reference:function(param){try{param.readOnly||($("#"+param.id).selectmenu(),$("#"+param.id).selectmenu({select:function(event,ui){var val=$.Cmdbuild.utilities.getHtmlFieldValue("#"+param.id);param.value=val,$.Cmdbuild.custom.commands&&$.Cmdbuild.custom.commands.fieldChanged?$.Cmdbuild.custom.commands.fieldChanged(param):$.Cmdbuild.standard.commands.fieldChanged(param);var onchange=$("#"+param.id).attr("onChange");eval(onchange)}}));var objectField=new $.Cmdbuild.standard.referenceField(param);$("#"+param.id)[0].objectField=objectField}catch(e){throw $.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.scripts.lookup "+e.message),e}},checkbox:function(e){$('input[type="checkbox"][id="'+e.id+'"]').change(function(){this.checked?$('label[for="'+e.id+'"]').addClass("checked"):$('label[for="'+e.id+'"]').removeClass("checked")})},integer:function(e){try{$("#"+e.id).mask("##########")}catch(t){throw t.message!=$.Cmdbuild.errorsManager.CMERROR&&(t.message+="\n$.Cmdbuild.standard.scripts.integer"),$.Cmdbuild.errorsManager.log(t),t}},openMenu:function(e){try{$("#"+e.id).tooltip({content:$("#"+e.id).attr("title")})}catch(t){throw t.message!=$.Cmdbuild.errorsManager.CMERROR&&(t.message+="\n$.Cmdbuild.standard.scripts.openMenu"),$.Cmdbuild.errorsManager.log(t),t}},date:function(e){try{var t=$("#"+e.id);switch(e.type){case"timestamp":t.datetimepicker({dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"});break;case"time":t.timepicker({timeFormat:"HH:mm:ss"});break;case"dateTime":t.datetimepicker({dateFormat:"dd/mm/yy",timeFormat:"HH:mm:ss"});break;case"date":t.datepicker({dateFormat:"dd/mm/yy"})}}catch(i){throw i.message!=$.Cmdbuild.errorsManager.CMERROR&&(i.message+="\n$.Cmdbuild.standard.scripts.date"),$.Cmdbuild.errorsManager.log(i),i}},dialog:function(e){$("#"+e.id).dialog({autoOpen:!1,modal:!0,beforeClose:e.callback?e.callback:function(){},show:{effect:"fade",duration:250},hide:{effect:"explode",duration:500}})},menu:function(e){$("#"+e.id).menu()},grid:function(e){try{e.backend=$.Cmdbuild.utilities.getBackend(e.backend)}catch(t){throw t.message!=$.Cmdbuild.errorsManager.CMERROR&&(t.message+="\n$.Cmdbuild.standard.scripts.grid"),$.Cmdbuild.errorsManager.log(t),t}},button:function(e){$("#"+e.id).button({icons:{primary:e.icon},text:!1}).click(function(e){e.preventDefault()})},graph:function(e){var t={defaultNodeColor:"#ec5148",defaulLabelColor:"#99f",defaultEdgeColor:"#aaa",edgeColor:"default",labelSizeRatio:".5",labelThreshold:.1},i=new sigma({container:e.id,settings:t});visit(e.className,e.cardId,e.description,{},{},{},i),i.startForceAtlas2()}};$.Cmdbuild.standard.scripts=scripts}(jQuery),function(e){var t=function(t){this.param=t,this.backend=void 0,this.loadLookup=function(){var t=[],i=e("#"+this.param.id),a="$fromBackend"==this.param.value?this.backend.getValue():this.param.value;this.param.hideEmptyOption||t.push("<option entryValue='' "+(this.param.value?"":"selected")+"></option>");for(var n=0;n<this.backend.data.length;n++){var r=this.backend.data[n],d=a&&a==r._id?"selected":"",l=" entryValue='"+r._id+"' ",s=" value='"+r._id+"' ";t.push("<option "+l+d+s+">"+r.description+"</option>")}i.empty(),i.append(t.join("")).selectmenu(),i.selectmenu("refresh"),i.trigger("change"),this.onInitComplete()},this.init=function(){try{var i=e.Cmdbuild.utilities.getBackend(t.backend);this.backend=new i(this.param,this.loadLookup,this)}catch(a){e.Cmdbuild.errorsManager.log(a)}},this.onInitComplete=function(){this.param.refreshGridAfterInit&&e.Cmdbuild.standard.commands.refreshGrid({form:this.param.refreshGridAfterInit})},this.init()};e.Cmdbuild.standard.selectField=t,e.Cmdbuild.standard.selectField.setValue=function(t,i){var a=e("#"+t);a.val(""),a.selectmenu("refresh")},e.Cmdbuild.standard.selectField.clearValue=function(t){var i=e("#"+t);i.val(""),i.selectmenu("refresh")}}(jQuery),function(e){var t=function(){this.param=void 0,this.forms=[],this.init=function(t){try{this.param=t,this.show()}catch(i){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.init"),i}},this.show=function(){try{var t=e.Cmdbuild.elementsManager.getElement(this.param.form);this.forms=this.getForms(t),this.prepareParams(this.forms),this.includeForms()}catch(i){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.show"),i}},this.showCB=function(){try{var t=e.Cmdbuild.elementsManager.getElement(this.param.form);e.Cmdbuild.eventsManager.deferEvents();var i=e.Cmdbuild.elementsManager.getXmlElementId(t);this.forms=this.getForms(t);var a="<div id='"+i+"'>";a+=this.insertTitles(this.forms),a+=this.insertForms(this.forms),a+="</div>";var n=e("#"+this.param.container)[0];n.innerHTML=a,e.Cmdbuild.elementsManager.initialize(),e.Cmdbuild.eventsManager.unDeferEvents(),e("#"+i).tabs({activate:function(t,i){e(e.fn.dataTable.tables(!0)).DataTable().columns.adjust(),e.Cmdbuild.standard.tabbed.fireChangeTab(i.newPanel[0].id)}})}catch(r){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.show"),r}},this.getForms=function(t){var i=[],a=e(t);return a.children("form").each(function(t){var a=e(this),n=e.Cmdbuild.elementsManager.getParams(a),r=e.Cmdbuild.utilities.getFields(a);r&&e.Cmdbuild.dataModel.putFormFields(r),i.push({form:this,title:a.attr("title"),id:a.attr("id"),include:a.attr("include"),classes:a.attr("class"),invisible:a.attr("invisible"),params:n})}),i},this.prepareParams=function(t){try{for(var i=0;i<t.length;i++)t[i].params&&e.Cmdbuild.dataModel.prepareCallerParameters(t[i].id,t[i].params)}catch(a){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.prepareParams"),a}},this.insertTitles=function(t){try{var i="";i+="<ul>";for(var a=0;a<t.length;a++){var n="";"true"===t[a].invisible&&(n=" class='invisible' "),i+="<li "+n+"><a href='#"+t[a].id+"'>"+t[a].title+"</a></li>"}return i+="</ul>"}catch(r){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.insertTitles"),r}},this.includeForms=function(){if(this.forms.length<=0)return void this.showCB();var t=this.forms[0];this.forms.splice(0,1),e.Cmdbuild.utilities.include(t.form,this.includeForms,{},this)},this.insertForms=function(t){try{for(var i="",a=0;a<t.length;a++)i+="<div id='"+t[a].id+"' class='"+t[a].classes+"'>",i+=e.Cmdbuild.elementsManager.insertChildren(t[a].form),i+="</div>";return i}catch(n){throw e.Cmdbuild.errorsManager.log("$.Cmdbuild.standard.tabbed.insertForms"),n}}};e.Cmdbuild.standard.tabbed=t,e.Cmdbuild.standard.tabbed.fireChangeTab=function(t){var i=e.Cmdbuild.elementsManager.getElement(t);e.Cmdbuild.dataModel.pushParametersOnStack(t);var a=e.Cmdbuild.elementsManager.getEvent("onClick",i);e.Cmdbuild.eventsManager.onEvent(a)}}(jQuery),function(e){var t={getWidgetDiv:function(t){try{htmlStr="";var i=this.createXmlDiv(t.form,t.widgets,t.container,t.readOnly);return htmlStr+=e.Cmdbuild.elementsManager.toHtml(i),htmlStr+=this.createAllPopups(t.form,t),htmlStr}catch(a){e.Cmdbuild.errorsManager.popup(a)}},createXmlDiv:function(t,i,a,n){var r="<div";r+=" class='ui-widget-content ui-corner-all cmdbuild-widget-container' ",r+=" withReturn='true' ",r+=">";for(var d=0;d<i.length;d++)r+=this.createXmlButton(t,i[d],a,n);r+="</div>";for(var d=0;d<i.length;d++){var l=e.Cmdbuild.standard.widgetDiv.widgetName(i[d].type);e.Cmdbuild.widgets[l]&&e.Cmdbuild.widgets[l].cleanData(t,i[d])}var s=new DOMParser;return xDoc=s.parseFromString(r,"text/xml"),xDoc.documentElement},createXmlButton:function(e,t,i,a){var n=e+"_"+t._id,r="<button ";return r+=" id='"+n+"' ",r+=" text='"+t.label+"' ",r+=">",r+="<onClick>",r+="<command>navigate</command>",r+="<dialog>"+n+"_widgetDialog</dialog>",r+="<container>"+i+"</container>",r+="<form>"+n+"_dialogForm</form>",r+="<title>"+t.label+"</title>",r+="</onClick>",r+="<params>",r+="<dialog>"+n+"_widgetDialog</dialog>",r+="<widgetId>"+n+"</widgetId>",r+="<widgetClassName>"+t.data.className+"</widgetClassName>",r+="<singleSelect>"+t.data.singleSelect+"</singleSelect>",r+="<formData>"+e+"</formData>",r+="<selection>"+(1==t.data.noSelect?"false":"true")+"</selection>",r+="<editable>"+t.data.allowCardEditing+"</editable>",r+="<readOnly>"+("true"==a?"true":"false")+"</readOnly>",r+="<widgetName>"+n+"</widgetName>",r+="</params>",r+="</button>"},createXmlDialog:function(e){var t="<dialog id='"+e+"_widgetDialog'></dialog>",i=new DOMParser;return xDoc=i.parseFromString(t,"text/xml"),xDoc.documentElement},createAllPopups:function(t,i){for(var a="",n=0;n<i.widgets.length;n++){var r=t+"_"+i.widgets[n]._id,d={data:i.widgets[n].data,form:t};if(e.Cmdbuild.dataModel.getWidgetWindow(r))e.Cmdbuild.dataModel.substituteWidgetWindow(r,d);else{var l=this.createXmlDialog(r);a+=e.Cmdbuild.elementsManager.toHtml(l),e.Cmdbuild.dataModel.putWidgetWindow(r,d)}this.widgetForm(r,i,i.widgets[n])}return a},widgetForm:function(t,i,a){var n=e.Cmdbuild.standard.widgetDiv.widgetName(a.type)+".xml",r="<form title='Example' id='"+t+"_dialogForm'";r+=" include='"+n+"'",r+=" fileType='widget'",r+=" withId='"+t+"'",r+=" class='cmdbuildTabbedForm'/>";var d=new DOMParser;xDoc=d.parseFromString(r,"text/xml");var l=xDoc.documentElement,s=e.Cmdbuild.elementsManager.getElement(i.container);s.appendChild(l)},getFiter:function(e){var t="";return t}};e.Cmdbuild.standard.widgetDiv=t,e.Cmdbuild.standard.widgetDiv.widgetName=function(e){var t=e.split(".");return t[t.length-1]}}(jQuery),function(e){var t={SAVEONCARD:"SAVEONCARD",SAVEAFTER:"SAVEAFTER",getWidgetsData:function(t,i){var a={};if(!i)return a;for(var n=0;n<i.length;n++){var r=e.Cmdbuild.standard.widgetDiv.widgetName(i[n].type);e.Cmdbuild.widgets[r]?a[i[n]._id]={data:e.Cmdbuild.widgets[r].save(t,i[n]),saveType:e.Cmdbuild.widgets[r].saveMethod,widgetType:i[n].type}:console.log("Widget "+r+" not found!")}return a},saveOnDataWidgets:function(t,i){var a=[];for(var n in i){var r=i[n],d={};if(r.saveType==e.Cmdbuild.widgets.SAVEONCARD){for(var l in r.data)d[l]={};a.push({_id:n,output:d})}}t._widgets=a},savePostponedWidgets:function(e,t,i,a,n,r){var d=e.slice();this.savePostponedWidgetsRecursive(d,t,i,a,function(){n.apply(r,[])},this)},savePostponedWidgetsRecursive:function(t,i,a,n,r,d){if(t.length<=0)return void r.apply(d,[]);var l=t[0];t.splice(0,1);var s=i[l._id];if(!s)return void r.apply(d,[]);if(s.saveType==e.Cmdbuild.widgets.SAVEAFTER){var o=e.Cmdbuild.standard.widgetDiv.widgetName(s.widgetType);e.Cmdbuild.widgets[o].flush(a,i[l._id].data,l._id,n,function(){this.savePostponedWidgetsRecursive(t,i,a,n,r,d)},this)}},evaluateCqlFields:function(t,i){for(var a=0;a<i.length;a++){var n=i[a],r=e.Cmdbuild.standard.widgetDiv.widgetName(n.type);e.Cmdbuild.widgets[r]&&e.Cmdbuild.widgets[r].evaluateCql&&e.Cmdbuild.widgets[r].evaluateCql(t,n)}},initialize:function(t,i){for(var a=0;a<i.length;a++){var n=i[a],r=e.Cmdbuild.standard.widgetDiv.widgetName(n.type);e.Cmdbuild.widgets[r]&&e.Cmdbuild.widgets[r].initialize&&e.Cmdbuild.widgets[r].initialize(t,n)}},refreshCqlField:function(t,i){void 0===i&&(i=[]);for(var a=0;a<i.length;a++){var n=i[a],r=e.Cmdbuild.standard.widgetDiv.widgetName(n.type);e.Cmdbuild.widgets[r]&&e.Cmdbuild.widgets[r].refreshCqlField&&e.Cmdbuild.widgets[r].refreshCqlField(t,n)}},refreshTemplate:function(t,i,a){for(var n=0;n<i.length;n++){var r=i[n],d=e.Cmdbuild.standard.widgetDiv.widgetName(r.type);e.Cmdbuild.widgets[d]&&e.Cmdbuild.widgets[d].refreshTemplate&&e.Cmdbuild.widgets[d].refreshTemplate(t,i[n],a)}},prepareFields:function(t){for(var i=0;i<t.length;i++){var a=t[i],n=e.Cmdbuild.standard.widgetDiv.widgetName(a.type);e.Cmdbuild.widgets[n]&&e.Cmdbuild.widgets[n].prepareFields&&e.Cmdbuild.widgets[n].prepareFields(a)}}};e.Cmdbuild.widgets=t}(jQuery);
//# sourceMappingURL=standard.min.js.map